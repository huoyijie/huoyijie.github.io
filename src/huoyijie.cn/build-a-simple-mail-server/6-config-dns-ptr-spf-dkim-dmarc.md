# 配置 DNS|PTR|SPF|DKIM|DMARC

前面提到过，自己搭建的邮箱服务器通常信用度很低，从别的邮箱域给自己的邮箱域 `@huoyijie.cn` 发邮件是可以的，但是从自己的邮箱域给外部域(如 `qq.com`)可能会被拒绝。主要原因就是不被信任，垃圾邮件到处都是，一般的邮件服务提供商会采取比较严格的过滤策略。

如果想给外部域发邮件怎么办呢，只能去努力提升自身信用度。其中有一件事情可以马上去做，就是申请邮件服务器 `IP` 到 邮箱服务器域名 `mail.huoyijie.cn` 的反向解析 `PTR`。我们的邮箱服务器向第三方投递邮件时，对方只有我们的 `IP`，他们是没有办法确认我们的邮箱服务器的身份的。虽然我们自己声称是 `mail.huoyijie.cn`，但是他们不信。

这件事得有一个权威来证明，就是通过 IP 反向查询，找到对应的域名，看看是不是和自己声称的一致。这个权威就是为你提供 IP 的机构。需要向他们提交反向解析申请，一般都是通过云服务商来申请。我使用的是腾讯云的服务，所以只要提交一个工单申请反向解析。说清楚是从哪个 IP 反向解析到哪个域名。

对于我来说是 62.234.116.248 -> `mail.huoyijie.cn`，从腾讯云处理完成到反向解析生效，一般是 24～48 小时。

反向解析配置前

```bash
$ nslookup 62.234.116.248
** server can't find 248.116.234.62.in-addr.arpa: NXDOMAIN
```

配置生效后

```bash
$ nslookup 62.234.116.248
248.116.234.62.in-addr.arpa	name = mail.huoyijie.cn.

Authoritative answers can be found from:
```

还有一个是配置 SPF 记录，是在域名 `huoyijie.cn` 上添加一条 `TXT` 记录，内容为 `v=spf1 a mx ip4:62.234.116.248 -all`。

这样对方的邮件服务器收到来自域 `huoyijie.cn` 的邮件时，会来查询 `huoyijie.cn` 对应的 `TXT` 记录，确认可以发送 `huoyijie.cn` 这个域邮件的服务器 IP 地址。如果当前来投递邮件的客户端 IP 地址和 查询到的 SPF 记录一致，则可以信任来自该客户端的投递。

OK，关于如何安装和配置邮件服务器就先介绍到这里了。